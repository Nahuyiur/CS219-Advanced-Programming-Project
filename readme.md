# MiniVim 项目文档

项目组成员：娄毅彬、芮煜涵、郭振弘

### 项目简介

MiniVim 是一个轻量级的文本编辑器，灵感来源于 Vim。它实现了核心编辑功能，并支持三种模式：**普通模式**、**插入模式** 和 **命令模式**。MiniVim 提供了**文件操作、文本编辑、多文件导航、撤销/重做操作以及基于行的命令功能等**，满足基本的文本编辑需求。以下是功能和使用方法的详细说明。

------

### 模式与功能

#### 1. 普通模式

**用途**：这是 MiniVim 的默认模式，用于光标导航、删除、复制和粘贴操作。

**功能列表**：

- 光标导航
  - `h`和`←`：光标向左移动。
  - `j`和`↓`：光标向下移动。
  - `k`和`↑`：光标向上移动。
  - `l`和`→`：光标向右移动。
- 行操作
  - `0`：移动光标到当前行的起始位置。
  - `$`：移动光标到当前行的末尾位置。
  - `dd`：删除当前行。
  - `yy`：复制当前行。
  - `p`：粘贴复制的行到当前行下方。
- 跳转操作
  - `gg`：跳转到文件第一行的起始位置。
  - `G`：跳转到文件的最后一行的起始位置。
- 撤销与重做
  - `u`：撤销上一次操作。
  - `Ctrl+r`：重做上一次撤销的操作。
- 窗口调整
  - 当光标移动到窗口的边缘时，MiniVim会自动滚动窗口，确保光标位置保持在可视区域内。
  - 垂直滚动：
    - 如果光标向上移动超出窗口顶部，窗口会自动向上滚动。
    - 如果光标向下移动超出窗口底部，窗口会自动向下滚动。
  - 水平滚动：
    - 如果光标向左移动超出窗口左侧边界，窗口会自动向左滚动。
    - 如果光标向右移动超出窗口右侧边界，窗口会自动向右滚动。
  

------

#### 2. 插入模式

**用途**：插入文本内容。

**功能列表**：

- 光标移动

  - `←`：光标向左移动。

  - `↓`：光标向下移动。

  - `↑`：光标向上移动。

  - `→`：光标向右移动。

- 进入插入模式：在普通模式下按 `i` 键。
- 输入任意字符：直接将字符插入到光标所在位置。
- 回车键 (`Enter`)：在当前光标位置后插入新行。
- 退格键 (`Backspace`)：删除光标前的字符。
- 光标操作：
  - 光标可以自由移动到未操作的区域，输入时会自动补全前面的空格。
- 退出插入模式：按下 `Esc` 键,退回至普通模式。
- 窗口调整：同普通模式。

------

#### 3. 命令模式

**用途**：执行文件操作、搜索与替换、多文件管理等命令。

**功能列表**：

- **进入命令模式**：在普通模式下输入 `:` 会自动进入命令模式，之后输入的命令会在窗口最后一行显示。
- 文件操作指令（输入后按下`Enter`键）
  - `:w`：保存当前文件。
  - `:q`：退出编辑器。
  - `:wq`：保存并退出编辑器。
- 行跳转
  - 输入行号并回车（例如 `:5`）：跳转到第 5 行。
- 搜索与替换
  - `:s/旧字符串/新字符串/g`：替换当前行中的所有匹配字符串。
- 多文件管理
  - 可以在初始化阶段同时打开多个文件
  - `:e 文件名`：打开或切换到指定文件。
  - `:N`：切换到上一个文件。
  - `:n`：切换到下一个文件。
  - `:ls`：列出当前已打开的文件（之后按任意键退出）。
  - `:b 文件编号`：切换到指定编号的文件。
  

------

### 使用说明

1. **启动 MiniVim**：

   ```bash
   # 在命令行下运行指令：
   g++ -o MiniVim MiniVim.cpp -lncurses # 将源代码编译成可运行文件MiniVim
   ./MiniVim 文件名
   # 如：
   ./MiniVim file.txt # 打开一个文件
   ./MiniVim file1.txt file2.txt file3.txt  # 同时打开多个文件
   # 启动后窗口最下方会显示编辑器当前所在模式以及当前编辑的文件名
   ```

2. **操作模式切换**：

   - 启动后默认进入 **普通模式**。
   - 按 `i` 切换到 **插入模式**。
   - 按 `:` 切换到 **命令模式**。
   - 按 `Esc` 键返回到 **普通模式**。

3. **多文件管理**：

   - 使用 `:e` 打开新文件后，MiniVim 会将文件添加到历史记录中。
   - 通过 `:N` 或 `:n` 在多个文件间切换。

4. **撤销与重做**：

   - 在 **普通模式** 下按 `u` 撤销操作。
   - 使用 `Ctrl+r` 进行重做。

5. **退出编辑器**：

   - `:q`：退出（如果有未保存的更改会提示）。
   - `:wq`：保存后退出。

------

### 设计说明

​	此项目选择基于**ncurses库**的功能来实现。首先在命令行运行程序时我们读取运行命令后加上的文件目录信息，在读取文件后利用ncurses库初始化窗口并显示文件内容。之后利用**getch()**函数实时读取用户键盘输入的字符，并根据输入对于窗口的光标位置以及显示内容做出相应的改变。最后再把内容存储到文件内便实现了一个基础的Vim-like文档编辑器。

------

### 样例与说明

```
./MiniVim example.txt             # 启动 MiniVim，打开文件 example.txt
```

```
i                                  # 进入插入模式
Hello MiniVim!                     # 输入内容
<Enter>                            # 新开一行
This is a lightweight editor.      # 输入内容
<ESC>                              # 退出插入模式
```

```
yy                                 # 复制第一行
p                                  # 粘贴第一行到下一行
dd                                 # 删除光标所在行
```

```
0                                  # 光标移动到行首
l                                  # 光标向右移动一列
i                                  # 进入插入模式
-                                  # 在当前光标处插入字符
<ESC>                              # 退出插入模式
```

```
:5                                 # 跳转到文件的第 5 行（如果不存在则无操作）
$                                  # 光标移动到当前行的行尾
```

```
:s/editor/Editor/g                 # 替换当前行中的 "editor" 为 "Editor"
:w                                 # 保存文件
```

```
:e newfile.txt                     # 打开新文件 newfile.txt
i                                  # 进入插入模式
This is another file.              # 输入内容
<ESC>                              # 退出插入模式
:w                                 # 保存新文件
```

```
:N                                 # 切换到上一个文件 example.txt
:n                                 # 切换到下一个文件 newfile.txt
:ls								   # 显示"1.example.txt\n 2.newfile.txt"
:b 1                               # 切换到第一个文件example.txt
```

```
u                                  # 撤销上一步操作
<Ctrl+r>                           # 重做上一步撤销的操作
```

```
:wq                                 # 保存文件并退出编辑器
```

------------

### 开发亮点

1. **多文件支持**：实现了文件历史记录，可快速**在多个文件间切换**。
2. **跳转与替换**：支持**文本指定行的跳转**以及**当前行的模式化替换**。
3. **窗口调整**：支持**自动滚动窗口**，使得光标始终可见。
4. **高效撤销与重做**：通过**栈结构**实现操作历史的管理。

